import{r as e,a as t,R as r}from"./vendor-BXk_ma1u.js";import{m as s,A as a}from"./motion-CVR8sjCB.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var n={exports:{}},l={},i=e,c=Symbol.for("react.element"),o=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,m=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,r){var s,a={},n=null,l=null;for(s in void 0!==r&&(n=""+r),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(l=t.ref),t)d.call(t,s)&&!h.hasOwnProperty(s)&&(a[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===a[s]&&(a[s]=t[s]);return{$$typeof:c,type:e,key:n,ref:l,props:a,_owner:m.current}}l.Fragment=o,l.jsx=u,l.jsxs=u,n.exports=l;var x=n.exports,p={},f=t;p.createRoot=f.createRoot,p.hydrateRoot=f.hydrateRoot;const y=({onSearch:t,onSuggestionSelect:r,suggestions:n=[],loading:l})=>{const[i,c]=e.useState(""),[o,d]=e.useState(!1),[m,h]=e.useState(-1),u=e.useRef(null);e.useEffect(()=>{var e;null==(e=u.current)||e.focus()},[]);const p=e=>{c(e.plateNumber),d(!1),r(e)};return x.jsxs("div",{className:"relative w-full max-w-md mx-auto",children:[x.jsxs("form",{onSubmit:e=>{e.preventDefault(),i.trim()&&(t(i.trim()),d(!1))},className:"relative",children:[x.jsxs("div",{className:"relative",children:[x.jsx("input",{ref:u,type:"text",value:i,onChange:e=>{const t=e.target.value;c(t),h(-1),t.length>=2?d(!0):d(!1)},onKeyDown:e=>{if(o&&0!==n.length)switch(e.key){case"ArrowDown":e.preventDefault(),h(e=>e<n.length-1?e+1:0);break;case"ArrowUp":e.preventDefault(),h(e=>e>0?e-1:n.length-1);break;case"Enter":m>=0&&(e.preventDefault(),p(n[m]));break;case"Escape":d(!1),h(-1)}},onFocus:()=>i.length>=2&&d(!0),placeholder:"Enter plate number (e.g., ABC-1234)",className:"w-full px-4 py-3 pr-12 text-lg border-2 border-gray-300 rounded-xl \n                     focus:border-church-primary focus:outline-none transition-colors\n                     placeholder-gray-400 bg-white shadow-sm",disabled:l}),x.jsx("button",{type:"submit",disabled:!i.trim()||l,className:"absolute right-2 top-1/2 transform -translate-y-1/2 \n                     p-2 text-church-primary hover:text-church-secondary \n                     disabled:text-gray-400 transition-colors",children:l?x.jsx(s.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-5 h-5 border-2 border-church-primary border-t-transparent rounded-full"}):x.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),x.jsx(a,{children:o&&n.length>0&&x.jsx(s.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 \n                       rounded-lg shadow-lg z-50 overflow-hidden",children:n.map((e,t)=>x.jsxs(s.button,{type:"button",onClick:()=>p(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0\n                           "+(m===t?"bg-church-primary/10":""),whileHover:{backgroundColor:"#f9fafb"},children:[x.jsx("div",{className:"font-medium text-gray-900",children:e.plateNumber}),x.jsx("div",{className:"text-sm text-gray-600",children:e.displayText}),x.jsx("div",{className:"text-xs text-gray-500",children:e.vehicle})]},e.plateNumber))})})]}),x.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:x.jsx("span",{className:"inline-block",children:"💡 Try: ABC1234, ABC-1234, or ABC 1234"})})]})},g=({result:e,onClose:t})=>{if(!e)return null;const r=(e,t,r)=>x.jsxs("div",{className:"text-center space-y-4",children:[x.jsx("div",{className:"text-6xl",children:"⚠️"}),x.jsx("div",{className:"text-lg font-medium text-orange-700",children:r?"Exact Format Required":"Incorrect Symbol Format"}),x.jsxs("div",{className:"text-gray-600",children:["You searched for ",x.jsxs("strong",{className:"text-gray-900",children:['"',t,'"']})," but ",r||"the correct format is",":"]}),x.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:x.jsxs("div",{className:"text-sm",children:[x.jsx("strong",{className:"text-orange-800",children:"✅ Correct format:"}),x.jsx("div",{className:"mt-2 space-y-2",children:e.map((e,t)=>x.jsx("div",{className:"font-mono text-lg text-green-700 bg-green-50 px-3 py-2 rounded border",children:e},t))})]})}),x.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:x.jsxs("div",{className:"text-sm text-blue-800",children:[x.jsx("strong",{children:"💡 Symbol Rule:"})," When using symbols like dashes (-), slashes (/), or dots (.), they must match exactly as registered. Use spaces or no symbols for flexible search."]})})]});return x.jsxs(s.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"w-full max-w-lg mx-auto bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[x.jsx("div",{className:"bg-gradient-to-r from-church-primary to-church-secondary px-6 py-4",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("div",{className:"text-white font-medium",children:"not_found"===e.type?"Search Result":"Car Found"}),x.jsx("button",{onClick:t,className:"text-white/80 hover:text-white transition-colors p-1",children:x.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),x.jsxs("div",{className:"p-6",children:["ai_response"===e.type&&(i=e.response,x.jsx("div",{className:"space-y-1",children:(c=i,c.split("\n").map((e,t)=>{if(e.startsWith("🚗 **")&&e.includes("**"))return x.jsx("div",{className:"text-xl font-bold text-gray-900 mb-3",children:e.replace(/\*\*/g,"")},t);if(e.startsWith("👤 **")||e.startsWith("🚙 **")||e.startsWith("📋 **")){const r=e.replace(/\*\*/g,""),[s,...a]=r.split(" ");return x.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[x.jsx("span",{className:"text-lg",children:s}),x.jsx("span",{className:"font-medium text-gray-800",children:a.join(" ")})]},t)}return e.startsWith("📞")?x.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4",children:x.jsx("p",{className:"text-blue-800 text-sm",children:e})},t):e.startsWith("*Found via")||e.includes("confidence")?x.jsx("div",{className:"text-xs text-gray-500 mt-2 italic",children:e},t):e.trim()?x.jsx("p",{className:"text-gray-700 mb-2",children:e},t):x.jsx("br",{},t)}))})),"local_result"===e.type&&(a=e.data,n=e.confidence,l=e.matchType,x.jsxs("div",{className:"space-y-4",children:[x.jsx("div",{className:"text-center",children:x.jsxs("div",{className:"text-2xl font-bold text-gray-900 mb-2",children:["🚗 ",a.plateNumber]})}),x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("span",{className:"text-xl",children:"👤"}),x.jsxs("div",{children:[x.jsx("span",{className:"font-medium text-gray-800",children:"Owner: "}),x.jsx("span",{className:"text-gray-700",children:a.displayName})]})]}),x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("span",{className:"text-xl",children:"🚙"}),x.jsxs("div",{children:[x.jsx("span",{className:"font-medium text-gray-800",children:"Vehicle: "}),x.jsxs("span",{className:"text-gray-700",children:[a.manufacturer," ",a.carType]})]})]}),x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("span",{className:"text-xl",children:"📋"}),x.jsxs("div",{children:[x.jsx("span",{className:"font-medium text-gray-800",children:"Status: "}),x.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("Active Member"===a.memberStatus?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:a.memberStatus})]})]})]}),x.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:x.jsx("p",{className:"text-blue-800 text-sm",children:"📞 Please contact the owner directly or connect with Trustee OR Secretary."})}),n<100&&x.jsxs("div",{className:"text-xs text-gray-500 text-center italic",children:["Found via ",l," matching (",n,"% confidence)"]})]})),"symbol_mismatch"===e.type&&r(e.suggestions,e.userInput),"format_mismatch"===e.type&&r(e.suggestions,e.userInput,e.message),"not_found"===e.type&&x.jsxs("div",{className:"text-center space-y-4",children:[x.jsx("div",{className:"text-6xl",children:"🔍"}),x.jsx("div",{className:"text-lg font-medium text-gray-700",children:"No plate found"}),x.jsx("div",{className:"text-gray-600",children:"Please check the plate number and try again"}),x.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:x.jsxs("div",{className:"text-sm text-gray-600",children:[x.jsx("strong",{children:"💡 Try different formats:"}),x.jsxs("div",{className:"mt-1 space-y-1",children:[x.jsx("div",{children:"• Without symbols: ABC1234"}),x.jsx("div",{children:"• With dashes: ABC-1234"}),x.jsx("div",{children:"• With spaces: ABC 1234"})]})]})})]})]}),x.jsx("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-200",children:x.jsx("div",{className:"text-xs text-gray-500 text-center",children:"🏛️ St. John's Indian Orthodox Church"})})]});var a,n,l,i,c};class b{constructor(e){this.memberData=e||[],this.searchIndex=this.buildSearchIndex()}buildSearchIndex(){const e={exact:new Map,normalized:new Map};return this.memberData.forEach(t=>{const r=t["Plate Number"];if(!r)return;e.exact.set(r.toUpperCase(),t);const s=this.normalizePlateNumber(r);e.normalized.set(s,t)}),e}searchPlateNumber(e){if(!e||"string"!=typeof e)return null;const t=e.trim().toUpperCase();if(this.searchIndex.exact.has(t))return{match:this.searchIndex.exact.get(t),matchType:"exact",confidence:100};const r=this.normalizePlateNumber(t);if(r.length>=3&&r.length<=10&&this.searchIndex.normalized.has(r)){return{match:this.searchIndex.normalized.get(r),matchType:"normalized",confidence:95}}return null}normalizePlateNumber(e){return e.replace(/[^A-Z0-9]/g,"")}findSymbolSuggestions(e){const t=this.normalizePlateNumber(e),r=[];for(const s of this.memberData){const a=s["Plate Number"];if(!a)continue;this.normalizePlateNumber(a)===t&&a!==e&&r.push(a)}return r.slice(0,1)}generateCommonVariations(e){const t=new Set,r=this.normalizePlateNumber(e);if(r.length>=3){const e=r.split("");for(let r=2;r<=e.length-1&&r<=4;r++){const s=e.slice(0,r).join(""),a=e.slice(r).join("");a.length>=1&&t.add(`${s}-${a}`)}for(let r=2;r<=e.length-1&&r<=4;r++){const s=e.slice(0,r).join(""),a=e.slice(r).join("");a.length>=1&&t.add(`${s} ${a}`)}}return Array.from(t)}fuzzySearch(e){let t=null,r=0;for(const[s,a]of this.searchIndex.normalized){const n=this.calculateSimilarity(e,s);n>.8&&n>r&&(t=a,r=n)}return t?{match:t,confidence:Math.round(100*r)}:null}calculateSimilarity(e,t){const r=e.length,s=t.length;if(0===r)return 0===s?1:0;if(0===s)return 0;const a=Array(r+1).fill().map(()=>Array(s+1).fill(0));for(let l=0;l<=r;l++)a[l][0]=l;for(let l=0;l<=s;l++)a[0][l]=l;for(let l=1;l<=r;l++)for(let r=1;r<=s;r++){const s=e[l-1]===t[r-1]?0:1;a[l][r]=Math.min(a[l-1][r]+1,a[l][r-1]+1,a[l-1][r-1]+s)}const n=Math.max(r,s);return(n-a[r][s])/n}isValidCarNumberFormat(e){if(!e||"string"!=typeof e)return!1;const t=this.normalizePlateNumber(e);if(t.length<3||t.length>10)return!1;const r=/[A-Z]/i.test(t),s=/[0-9]/.test(t);return r&&s}maskPersonalInfo(e){if(!e)return null;const t=e["First Name"]||"",r=e["Last Name"]||"";return{displayName:`${t} ${r.length>=2?r.substring(0,2)+"*".repeat(Math.max(0,r.length-2)):r}`,plateNumber:e["Plate Number"],manufacturer:e["Car Manufacturer"],carType:e["Car Type"],memberStatus:"Y"===e.Member?"Active Member":"Non-Member"}}}const N=()=>{const[t,r]=e.useState(null),[n,l]=e.useState(!1),{searchPlateNumber:i,getSearchSuggestions:c,loading:o,error:d,totalMembers:m,activeMembers:h}=(()=>{const[t,r]=e.useState([]),[s,a]=e.useState(null),[n,l]=e.useState(!0),[i,c]=e.useState(null);e.useEffect(()=>{(async()=>{try{let e;l(!0);{let t=await fetch("/api/members");if(t.ok){const r=await t.json();if(!r.success)throw new Error("API failed");e=r.data}else{t=await fetch("/members_data.csv");const r=await t.text();e=o(r)}}r(e);const t=new b(e);a(t)}catch(e){console.error("Error loading member data:",e),c("Failed to load member data")}finally{l(!1)}})()},[]);const o=e=>{const t=e.trim().split("\n"),r=t[0].split(",").map(e=>e.trim());return t.slice(1).map(e=>{const t=e.split(",").map(e=>e.trim()),s={};return r.forEach((e,r)=>{s[e]=t[r]||""}),s})},d=e.useCallback(async(e,t=!0)=>{if(!(null==e?void 0:e.trim()))return null;try{if(t)try{const t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,memberData:m(e)})});if(t.ok){const e=await t.json();if(e.success)return{type:"ai_response",response:e.response,source:"api"}}}catch(r){console.log("API unavailable, falling back to local search")}if(s){const t=s.searchPlateNumber(e);if(t&&t.confidence>=80)return{type:"local_result",data:s.maskPersonalInfo(t.match),confidence:t.confidence,matchType:t.matchType,source:"local"}}return null}catch(a){return console.error("Search error:",a),null}},[s]),m=e=>{if(!t||0===t.length)return null;const r=e.match(/\b[A-Z0-9]{3,10}\b|\b[A-Z0-9]+[\s\-\/\.]+[A-Z0-9]+\b/gi);let s=[];r&&r.forEach(e=>{const r=e.replace(/[^A-Z0-9]/gi,"").toUpperCase(),a=/[A-Z]/i.test(r),n=/[0-9]/.test(r),l=/^(WHO|OWNS|CAR|FIND|THE|OWNER|TELL|CAN|YOU|WHOSE|LOOKING|FOR|NUMBER|HELP|NEED|SAW|WITH|THERE|PLATE|BLOCKING|SHOW|ALL|LIST|MEMBERS|HAS|MOST|WHAT|DOES|DRIVE|HELLO|HOW|ARE|DO)$/i.test(r);if(a&&n&&!l&&r.length>=3){const e=t.filter(e=>{const t=(e["Plate Number"]||"").replace(/[^A-Z0-9]/g,"").toUpperCase();return t===r||t.startsWith(r)||r.startsWith(t)||t.includes(r)||r.includes(t)});s.push(...e)}});const a=Array.from(new Set(s.map(e=>e["Plate Number"]))).map(e=>s.find(t=>t["Plate Number"]===e)).slice(0,10);if(0===a.length){const e=[...t].sort((e,t)=>(e["Plate Number"]||"").localeCompare(t["Plate Number"]||""));a.push(...e.slice(0,10))}const n=a.map(e=>{const t=e["First Name"]||"",r=e["Last Name"]||"";return`${e["Plate Number"]||""}: ${t} ${r}, ${e["Car Manufacturer"]||""} ${e["Car Type"]||""} - ${"Y"===e.Member?"Active Member":"Non-Member"}`}).join("\n");return`SJIOC Vehicle Database (${t.length} total vehicles, ${t.filter(e=>"Y"===e.Member).length} active members):\n\nMost relevant matches for your query:\n${n}\n\n[Note: If exact match not found above, plate number may not exist in database]`};return{searchPlateNumber:d,getSearchSuggestions:e.useCallback(e=>{if(!s||!e||e.length<2)return[];const r=e.replace(/[^A-Z0-9]/g,"").toUpperCase(),a=[];for(const n of t){const e=n["Plate Number"]||"";if(e.replace(/[^A-Z0-9]/g,"").startsWith(r)&&a.length<5){const t=s.maskPersonalInfo(n);a.push({plateNumber:e,displayText:`${e} - ${t.displayName}`,vehicle:`${n["Car Manufacturer"]} ${n["Car Type"]}`})}}return a},[s,t]),loading:n,error:i,memberData:t,totalMembers:t.length,activeMembers:t.filter(e=>"Y"===e.Member).length}})(),[u,p]=e.useState([]),f=async e=>{l(!0);try{const t=await i(e);r(t||{type:"not_found",query:e})}catch(t){console.error("Search failed:",t),r({type:"error",message:"Search failed. Please try again."})}finally{l(!1)}};e.useEffect(()=>{},[c]);return d?x.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center p-4",children:x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),x.jsx("div",{className:"text-xl font-medium text-red-800 mb-2",children:"Error Loading Data"}),x.jsx("div",{className:"text-red-600",children:d})]})}):x.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-church-primary/10 to-church-secondary/20",children:[x.jsx(s.header,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},className:"bg-white shadow-sm border-b border-gray-200",children:x.jsx("div",{className:"max-w-md mx-auto px-4 py-4",children:x.jsxs("div",{className:"text-center",children:[x.jsx("h1",{className:"text-xl font-bold text-gray-900 mb-1",children:"🏛️ SJIOC Car Lookup"}),x.jsx("p",{className:"text-sm text-gray-600",children:"Find car owners by license plate"}),!o&&x.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[m," vehicles • ",h," active members"]})]})})}),x.jsx("main",{className:"flex-1 p-4 pb-20",children:x.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[x.jsx(s.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},children:x.jsx(y,{onSearch:f,onSuggestionSelect:e=>{f(e.plateNumber)},onInputChange:e=>{if(e&&e.length>=2){const t=c(e);p(t)}else p([])},suggestions:u,loading:n||o})}),x.jsx(a,{mode:"wait",children:t&&x.jsx(g,{result:t,onClose:()=>r(null)},t.type)}),!t&&!n&&x.jsxs(s.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},className:"text-center space-y-4 py-8",children:[x.jsx("div",{className:"text-6xl",children:"🚗"}),x.jsxs("div",{className:"space-y-2",children:[x.jsx("h2",{className:"text-lg font-medium text-gray-800",children:"Welcome to SJIOC Car Lookup"}),x.jsx("p",{className:"text-gray-600 text-sm max-w-xs mx-auto",children:"Enter any plate number above to find the owner. We support all formats including spaces and symbols."})]}),x.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-gray-100 text-left",children:[x.jsx("h3",{className:"font-medium text-gray-800 mb-2 text-center",children:"✨ Features"}),x.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{children:"🔍"}),x.jsx("span",{children:"Smart search with typo tolerance"})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{children:"🔒"}),x.jsx("span",{children:"Privacy-protected member information"})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{children:"📱"}),x.jsx("span",{children:"Works with any plate number format"})]})]})]})]}),n&&x.jsxs(s.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-8",children:[x.jsx(s.div,{animate:{scale:[1,1.1,1],rotate:[0,180,360]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"text-4xl mb-3",children:"🔍"}),x.jsx("div",{className:"text-gray-600",children:"Searching..."})]})]})}),x.jsx("footer",{className:"bg-white border-t border-gray-200",children:x.jsx("div",{className:"max-w-md mx-auto px-4 py-3",children:x.jsxs("div",{className:"text-center text-xs text-gray-500",children:[x.jsx("div",{children:"Made for SJIOC Community"}),x.jsx("div",{className:"mt-1",children:"🔒 Secure • 🚀 Fast • 📱 Mobile-First"})]})})})]})};function j(){const[t,r]=e.useState(!1);return e.useEffect(()=>{if(r(window.self!==window.top),!document.querySelector('meta[name="viewport"]')){const e=document.createElement("meta");e.name="viewport",e.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.head.appendChild(e)}document.title="SJIOC Car Lookup"},[]),x.jsx("div",{className:"app "+(t?"embedded":"standalone"),children:x.jsx(N,{})})}p.createRoot(document.getElementById("root")).render(x.jsx(r.StrictMode,{children:x.jsx(j,{})}));
